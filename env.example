# AI Quality Kit Environment Configuration

# Frontend Configuration
VITE_BACKEND_URL=http://localhost:8000

# OpenAI Configuration
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-4o-mini

# Anthropic Configuration
ANTHROPIC_API_KEY=your_anthropic_api_key_here
ANTHROPIC_MODEL=claude-3-sonnet-20240229

# Snowflake Configuration
SNOWFLAKE_ACCOUNT=your_account
SNOWFLAKE_USER=your_username
SNOWFLAKE_PASSWORD=your_password
SNOWFLAKE_WAREHOUSE=your_warehouse
SNOWFLAKE_DATABASE=your_database
SNOWFLAKE_SCHEMA=your_schema

# RAG Configuration
RAG_TOP_K=4
RAG_SIMILARITY_THRESHOLD=0.7

# Cache Configuration
CACHE_TTL_HOURS=24
CACHE_ENABLED=true

# Logging Configuration
LOG_LEVEL=INFO
ENABLE_LOGGING=true

# Evaluation Configuration
ENABLE_LIVE_EVAL=true
RAGAS_THRESHOLD=0.5
RAGAS_ENABLED=true
RAGAS_TIMEOUT_S=30
RAGAS_SAMPLE_SIZE=10

# RAG Quality Thresholds
RAG_QUALITY_THRESHOLD=0.4
FAITHFULNESS_THRESHOLD=0.5
ANSWER_RELEVANCY_THRESHOLD=0.4
CONTEXT_PRECISION_THRESHOLD=0.4
CONTEXT_RECALL_THRESHOLD=0.4

# Universal RAG Evaluation Thresholds
CONTEXT_RELEVANCE_THRESHOLD=0.1
HONESTY_DETECTION_THRESHOLD=0.7
SEMANTIC_ANALYSIS_WEIGHT=0.2
KEYWORD_ANALYSIS_WEIGHT=0.6
ENTITY_ANALYSIS_WEIGHT=0.2

# Red Team Configuration
REDTEAM_ENABLED=true
REDTEAM_FAIL_FAST=true
REDTEAM_MAX_STEPS=6
REDTEAM_SEED=0
REDTEAM_MASK_SECRETS=true
REDTEAM_REQUIRED_METRICS=prompt_injection,data_extraction

# Red Team UI Features
REDTEAM_UI_SUBTESTS_ENABLED=true
TEMPLATES_ENDPOINTS_ENABLED=true
SINGLE_FILE_ATTACKS=true
SENTENCE_TRANSFORMER_MODEL=all-MiniLM-L6-v2

# Negative Testing Configuration
ENABLE_NEGATIVE_TESTS=true
NEGATIVE_FAITHFULNESS_MAX=0.60
NEGATIVE_CONTEXT_RECALL_MAX=0.60
NEGATIVE_FORCE_IDK=true

# Security & Privacy
AUTH_ENABLED=true

# Authentication Mode: 'token' (default) or 'jwt'
AUTH_MODE=token

# Token-based Authentication (when AUTH_MODE=token)
AUTH_TOKENS=admin:SECRET_ADMIN,user:SECRET_USER

# JWT Authentication (when AUTH_MODE=jwt)
# Option 1: Symmetric Key (HS256)
JWT_SECRET=your-secret-key-256-bits-minimum-for-production
JWT_ISSUER=ai-quality-kit
JWT_AUDIENCE=api-client

# Option 2: Asymmetric Key (RS256) with JWKS
# JWT_JWKS_URL=https://your-auth-provider.com/.well-known/jwks.json
# JWT_ISSUER=https://your-auth-provider.com
# JWT_AUDIENCE=your-api-audience

# Role-Based Access Control (applies to both token and JWT modes)
RBAC_ALLOWED_ROUTES=/ask:user|admin,/orchestrator/*:user|admin,/reports/*:user|admin,/a2a/*:user|admin,/mcp/*:user|admin,/testdata/*:user|admin

# Audit & Privacy
AUDIT_LOG_ENABLED=false
PERSIST_DB=false                 # no user data written to DB by default
PERSIST_ONLY_AGGREGATES=false    # optional anonymized aggregates only (no raw text)

# Observability
PERF_COLD_WINDOW_SECONDS=120
PERF_PERCENTILES_ENABLED=false
PERF_WINDOW=500

# Providers (defaults; UI may override per request)
PROVIDER=openai
MODEL_NAME=gpt-4o-mini
ANTHROPIC_MODEL=claude-3.5-sonnet
GEMINI_MODEL=gemini-1.5-pro
GOOGLE_API_KEY=
ALLOWED_PROVIDERS=openai,anthropic,gemini,custom_rest,mock
CUSTOM_LLM_BASE_URL=

# Modes & UI/Reports
MCP_ENABLED=true
A2A_ENABLED=true
OFFLINE_MODE=false
UI_ENABLED=false
REPORTS_DIR=./reports
REPORT_AUTO_DELETE_MINUTES=10
ANONYMIZE_REPORTS=true

# Orchestrator
DEFAULT_TEST_SUITES=rag_quality,red_team,safety,performance,regression
RAGAS_SAMPLE_SIZE=8

# ===== Rate Limiting (P0 Hardening) =====
# Enable/disable rate limiting middleware (default: false)
RATE_LIMIT_ENABLED=false

# Rate limit rules in format: "METHOD:PATH=LIMIT/PERIOD;..."
# Examples: "POST:/orchestrator/run_tests=10/min;POST:/ask=60/min;*=300/min"
RATE_LIMIT_RULES="POST:/orchestrator/run_tests=10/min;POST:/ask=60/min;*=300/min"

# Optional Redis backend for distributed rate limiting
# REDIS_URL=redis://localhost:6379

# ===== Test Data Storage =====
# Redis backend for persistent test data storage
# REDIS_URL=redis://localhost:6379
REDIS_PREFIX=aqk:
TESTDATA_TTL_HOURS=24

# ===== Provider Resilience =====
# Timeouts and retries for LLM provider calls
PROVIDER_TIMEOUT_S=20                  # Request timeout in seconds
PROVIDER_MAX_RETRIES=2                 # Maximum retry attempts
PROVIDER_BACKOFF_BASE_MS=200           # Base backoff time in milliseconds
PROVIDER_CIRCUIT_FAILS=5               # Failures before circuit opens
PROVIDER_CIRCUIT_RESET_S=30            # Circuit reset time in seconds

# ===== JWT Authentication (Enhanced) =====
# Required for JWT mode
JWT_ISSUER=https://your-auth-provider.com     # Required in JWT mode
JWT_AUDIENCE=https://your-api.com              # Required in JWT mode

# ===== Audit Logging (P0 Hardening) =====
# Enable structured audit logging with PII redaction (default: false)
AUDIT_LOG_ENABLED=false

# Audit log file path with rotation (10MB x 5 files)
AUDIT_LOG_PATH="logs/audit.log"

# ===== Power BI Integration =====
# Optional Power BI integration for publishing test results
POWERBI_ENABLED=false                         # Enable Power BI publishing (default: false)
POWERBI_TENANT_ID=                           # Azure AD tenant ID
POWERBI_CLIENT_ID=                           # Azure AD app client ID
POWERBI_CLIENT_SECRET=                       # Azure AD app client secret
POWERBI_WORKSPACE_ID=                        # Power BI workspace (group) ID
POWERBI_DATASET_NAME=AIQK Results            # Power BI dataset name (default: "AIQK Results")
POWERBI_EMBED_REPORT_URL=                    # Optional: Pre-built report URL for embedding

# ===== Safety Testing Configuration =====
# Enable safety testing suite (default: true)
SAFETY_ENABLED=true

# Safety testing behavior
SAFETY_FAIL_FAST=true                        # Stop on first required safety failure (default: true)

# Safety detection thresholds
SAFETY_TOXICITY_THRESHOLD=0.8               # Toxicity detection threshold (0.0-1.0)
SAFETY_HATE_THRESHOLD=0.8                   # Hate speech detection threshold
SAFETY_VIOLENCE_THRESHOLD=0.8               # Violence content threshold
SAFETY_ADULT_THRESHOLD=0.8                  # Adult content threshold
SAFETY_SELF_HARM_THRESHOLD=0.8              # Self-harm content threshold

# Safety UI features
SAFETY_UI_SUBTESTS_ENABLED=true             # Enable subtest selection in UI (default: true)

# ===== Bias Detection Configuration =====
# Enable bias detection suite (default: true)
BIAS_ENABLED=true

# Bias testing behavior
BIAS_FAIL_FAST=true                          # Stop on first required bias failure (default: true)

# Statistical significance and thresholds
BIAS_ALPHA=0.05                              # Significance level for statistical tests (default: 0.05)
BIAS_MAX_REFUSAL_GAP_PP=5                    # Max refusal rate gap in percentage points (default: 5)
BIAS_MAX_LENGTH_REL_GAP=0.10                 # Max relative response length gap (default: 0.10)

# Bootstrap and sampling settings
BIAS_BOOTSTRAP_N=2000                        # Number of bootstrap samples (default: 2000)

# Refusal detection settings
BIAS_REFUSAL_MARKERS_FILE=./apps/config/refusal_markers.txt  # Path to refusal markers file
BIAS_TOKENIZER=auto                          # Tokenizer: "auto" for word count, or specific tokenizer

# Bias UI features
SHOW_BIAS_JSONL_TEMPLATE=false               # Show JSONL template option in UI (default: false)

# ===== Performance Testing Configuration =====
# Enable performance testing suite (default: true)
PERF_ENABLED=true

# Performance testing behavior
PERF_FAIL_FAST=true                          # Stop on first required performance failure (default: true)

# Default load settings
PERF_CLIENT_MODE=closed_loop                 # Default load mode if scenario omits (default: closed_loop)
PERF_TIMEOUT_MS=60000                        # Request timeout in milliseconds (default: 60000)
PERF_DEFAULT_CONCURRENCY=4                   # Default concurrency for closed-loop (default: 4)
PERF_DEFAULT_RATE_RPS=8                      # Default RPS for open-loop (default: 8)
PERF_DEFAULT_DURATION_SEC=30                 # Default scenario duration (default: 30)

# Performance thresholds
PERF_P95_MS_MAX=2500                         # Max P95 latency in milliseconds (default: 2500)
PERF_ERROR_RATE_MAX=0.02                     # Max error rate (0-1) (default: 0.02)
PERF_TIMEOUT_RATE_MAX=0.01                   # Max timeout rate (0-1) (default: 0.01)
PERF_THROUGHPUT_MIN_RPS=5                    # Min throughput RPS (default: 5)
PERF_TOKENS_PER_SEC_MIN=0.0                  # Min tokens per second (default: 0.0)
PERF_MEMORY_PEAK_MB_MAX=1024                 # Max memory peak MB (default: 1024)

# Observability settings
PERF_OBSERVABILITY_HEADERS=true              # Send X-Perf-Phase headers and capture X-Latency-MS (default: true)

# Performance UI features
SHOW_PERF_JSONL_TEMPLATE=false               # Show JSONL template option in UI (default: false)

# Adaptive Test Generation Configuration
ADAPTIVE_TESTS_ENABLED=true                  # Enable adaptive test generation (default: true)
ADAPTIVE_COMPLIANCE_ENABLED=true             # Enable adaptive compliance tests (default: true)
ADAPTIVE_BIAS_ENABLED=true                   # Enable adaptive bias tests (default: true)
ADAPTIVE_FALLBACK_ENABLED=true               # Enable fallback to hardcoded tests (default: true)

# LLM Profiling Configuration
LLM_PROFILING_ENABLED=true                   # Enable automatic LLM profiling (default: true)
LLM_PROFILE_CACHE_TTL=3600                   # LLM profile cache TTL in seconds (default: 3600)

# Cultural/Language Adaptation
ADAPTIVE_CULTURAL_CONTEXT=auto               # Cultural context: auto|western|turkish|european (default: auto)
ADAPTIVE_PRIMARY_LANGUAGE=auto               # Primary language: auto|en|tr|de (default: auto)

# Industry-Specific Tests
ADAPTIVE_DEFAULT_INDUSTRY=general            # Default industry: general|healthcare|finance|education (default: general)
ADAPTIVE_DOMAIN_TESTS_ENABLED=true           # Enable domain-specific test generation (default: true)

# RAG Embedding Robustness Configuration
RAG_ER_ENABLED=true                          # Master switch for Embedding Robustness subtest (default: true)
RAG_ER_K=20                                  # Top-k for recall/overlap metrics (default: 20)
RAG_ER_RECALL_MIN=0.90                       # Minimum recall threshold for gating (default: 0.90)
RAG_ER_OVERLAP_MIN=0.60                      # Minimum overlap threshold for gating (default: 0.60)
RAG_ER_ANS_STABILITY_MIN=0.75                # Minimum answer stability threshold (default: 0.75)
RAG_ER_QUERY_REWRITES=3                      # Number of paraphrases to generate if not provided (default: 3)
RAG_ER_HYBRID_ENABLED=true                   # Enable dense + BM25 fusion (default: true)
RAG_ER_RRF_K=60                              # RRF constant for hybrid fusion (default: 60)
RAG_ER_RERANKER_ENABLED=false                # Enable optional cross-encoder reranking (default: false)
RAG_ER_MMR_ENABLED=true                      # Enable MMR diversification (default: true)
RAG_ER_MMR_LAMBDA=0.4                        # MMR lambda parameter (default: 0.4)
RAG_ER_EMBED_MODEL=default                   # Embedding model to use (default: default)
RAG_ER_LLM_REWRITE_MODEL=default             # LLM model for paraphrase generation (default: default)
RAG_ER_LOW_AGR_STD_MIN=0.08                  # Min std of paraphrase embeddings to flag low-agreement (default: 0.08)
RAG_ER_FAIL_FAST=true                        # Gate immediately when required ER case fails (default: true)
